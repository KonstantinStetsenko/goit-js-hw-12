{"version":3,"file":"index.js","sources":["../src/js/pixabay-api.js","../src/js/render-functions.js","../src/main.js"],"sourcesContent":["import axios from 'axios';\nimport { search } from '../main';\nimport { _page } from '../main';\nimport { refs } from '../main';\n\nexport let searchTerm = '';\nexport let arrData = [];\nexport let totalImage = 0;\nexport let totalPages = 0;\nexport let _per_page = 15;\n\nconst API_KEY = '35615577-2bf6ed1d70f9a1c328f0e4a49';\nconst BASE_URL = 'https://pixabay.com/api/';\n\nexport async function fetchGallery(search, page = 1) {\n  arrData = []; // Очистка перед новым запросом\n\n  try {\n    const response = await axios({\n      url: BASE_URL,\n      params: {\n        key: API_KEY,\n        q: search,\n        image_type: 'photo',\n        orientation: 'horizontal',\n        safesearch: true,\n        per_page: _per_page,\n        page: page, // используем переданный параметр\n      },\n    });\n\n    arrData = response.data.hits;\n    totalImage = response.data.totalHits;\n    totalPages = totalImage / _per_page; // округляем в большую сторону\n\n    return { hits: arrData, totalHits: totalImage }; // возвращаем нужные данные\n  } catch (error) {\n    console.error('Error fetching data:', error);\n    return { hits: [], totalHits: 0 }; // возвращаем пустые данные при ошибке\n  }\n}\n","import SimpleLightbox from 'simplelightbox';\nimport 'simplelightbox/dist/simple-lightbox.min.css';\nimport { arrData } from './pixabay-api';\n// import { userConteinerUL } from '../main';\nimport { refs } from '../main';\n// const gallery = document.querySelector('.gallery');\nlet lightbox = new SimpleLightbox('.gallery a', {\n  captions: true,\n  captionsData: 'alt',\n  captionDelay: 250,\n});\n\nexport function renderGallery(arrData) {\n  if (arrData.length === 0) {\n    console.log('Нет данных для отображения');\n    return;\n  }\n\n  const markup = arrData\n    .map(data2 => {\n      return `<li class=\"list-photo\">\n                <div class=\"gallery\">\n                  <a href=\"${data2.largeImageURL}\" class=\"gallery-item\">\n                    <img src=\"${data2.webformatURL}\" alt=\"${data2.tags}\" loading=\"lazy\" />\n                  </a>\n                </div>\n                <div class=\"container-total\">\n                  <div class=\"item\">\n                    <h2 class=\"head-photo\">likes</h2>\n                    <p class=\"total-photo\">${data2.likes}</p>\n                  </div>\n                  <div class=\"item\">\n                    <h2 class=\"head-photo\">views</h2>\n                    <p class=\"total-photo\">${data2.views}</p>\n                  </div>\n                  <div class=\"item\">\n                    <h2 class=\"head-photo\">comments</h2>\n                    <p class=\"total-photo\">${data2.comments}</p>\n                  </div>\n                  <div class=\"item\">\n                    <h2 class=\"head-photo\">downloads</h2>\n                    <p class=\"total-photo\">${data2.downloads}</p>\n                  </div>\n                </div>\n              </li>`;\n    })\n    .join('');\n\n  refs.userContainerUL.insertAdjacentHTML('beforeend', markup);\n  lightbox.refresh();\n}\n","import iziToast from 'izitoast';\nimport 'izitoast/dist/css/iziToast.min.css';\nimport { arrData, fetchGallery, totalImage } from './js/pixabay-api';\nimport { renderGallery } from './js/render-functions';\nimport { totalPages } from './js/pixabay-api';\nimport { _per_page } from './js/pixabay-api';\nexport let search = '';\nexport let _page = 1;\nexport const refs = {\n  userContainerUL: document.querySelector('.users-list'),\n  loader: document.querySelector('.loader'),\n  loaderButton: document.querySelector('.loader-button'),\n  form: document.querySelector('.form-serch'), // форма поиска\n  btn: document.querySelector('.loadButton'), // кнопка загрузки\n  gallery: document.querySelector('.gallery'),\n  input: document.querySelector('.input-serch'), // поле ввода поиска\n};\n\n// Показать или скрыть лоадер\nfunction showLoader() {\n  refs.loader.classList.add('loader');\n}\nfunction hideLoader() {\n  refs.loader.classList.remove('loader');\n}\n\n// Показать или скрыть лоадер кнопки\nfunction showLoaderButton() {\n  refs.loaderButton.style.display = 'flex';\n}\nfunction hideLoaderButton() {\n  refs.loaderButton.style.display = 'none';\n}\n\n// Показать или скрыть кнопку\nfunction showBtn() {\n  refs.btn.classList.remove('buttonHiden');\n}\nfunction hideBtn() {\n  refs.btn.classList.add('buttonHiden');\n}\n\n// Скрываем лоадер при загрузке страницы\ndocument.addEventListener('DOMContentLoaded', () => {\n  hideLoader();\n});\n\n// Очистка страницы\nfunction clearPage() {\n  if (refs.userContainerUL) {\n    refs.userContainerUL.innerHTML = '';\n  }\n}\n\n// Обработка отправки формы\nasync function handleFormSubmit(event) {\n  event.preventDefault(); // предотвращаем перезагрузку страницы\n  clearPage();\n  search = refs.input.value.trim(); // убираем лишние пробелы\n  _page = 1;\n\n  if (!search) {\n    hideBtn();\n    hideLoader();\n    iziToast.warning({\n      message: 'Запрос пустой',\n      backgroundColor: '#ffa500',\n      messageSize: 16,\n      messageColor: '#FFF',\n      iconColor: '',\n      titleColor: '#fa0598e5',\n      icon: 'info-outline',\n      titleSize: 16,\n      messageLineHeight: 24,\n      position: 'topRight',\n    });\n    return;\n  }\n\n  showLoader(); // показываем лоадер\n\n  try {\n    await fetchGallery(search); // выполняем запрос по ключевому слову\n\n    // Переносим проверку после того, как данные загружены\n    if (totalPages <= 1) {\n      hideBtn(); // Если только одна страница, скрываем кнопку \"Load More\"\n    } else {\n      showBtn(); // Показать кнопку, если больше одной страницы\n    }\n\n    if (arrData.length === 0) {\n      hideBtn();\n      iziToast.show({\n        message:\n          'Sorry, there are no images matching your search query. Please try again!',\n        backgroundColor: '#ffa500',\n        messageSize: 16,\n        messageColor: '#FFF',\n        iconColor: '',\n        titleColor: '#ffa500',\n        icon: 'info-outline',\n        titleSize: 16,\n        messageLineHeight: 24,\n        position: 'topRight',\n      });\n    } else {\n      renderGallery(arrData); // отрисовываем результаты\n    }\n\n    hideLoader(); // скрываем лоадер\n  } catch (error) {\n    console.error('Ошибка при получении данных:', error);\n    hideLoader();\n    iziToast.error({\n      message: 'Произошла ошибка при загрузке данных',\n      backgroundColor: '#ff0000',\n      position: 'topRight',\n    });\n  }\n\n  refs.input.value = ''; // очищаем поле ввода\n}\n\n// Добавляем обработчик события на отправку формы\nrefs.form.addEventListener('submit', handleFormSubmit);\nhideLoaderButton();\n// Скрол страницы\nfunction smoothScroll() {\n  const lastArticle = refs.userContainerUL.lastElementChild;\n  const ArticleHeight = lastArticle.getBoundingClientRect().height;\n  const scrolHeight = ArticleHeight * 2;\n\n  window.scrollBy({\n    top: scrolHeight,\n    left: 0,\n    behavior: 'smooth',\n  });\n}\n// Обработка кнопки загрузки следующей страницы\nrefs.btn.addEventListener('click', async () => {\n  try {\n    _page += 1; // увеличиваем номер страницы при клике\n\n    // Показать лоадер кнопки\n    showLoaderButton(); // показываем лоадер кнопки\n\n    const { hits, totalHits } = await fetchGallery(search, _page); // загружаем следующую страницу\n\n    // Проверка, есть ли еще страницы для загрузки\n    if (_page > totalPages) {\n      renderGallery(hits);\n      smoothScroll();\n      hideBtn(); // скрываем кнопку, если это последняя страница\n      iziToast.warning({\n        message: \"We're sorry, but you've reached the end of search results.\",\n        backgroundColor: '#ffa500',\n        messageSize: 16,\n        messageColor: '#FFF',\n        iconColor: '',\n        titleColor: '#fa0598e5',\n        icon: 'info-outline',\n        titleSize: 16,\n        messageLineHeight: 24,\n        position: 'topRight',\n      });\n      return; // Выходим, чтобы не выполнять повторную отрисовку\n    }\n\n    // Если есть данные, рендерим их\n    if (hits.length > 0) {\n      renderGallery(hits); // отрисовываем данные\n    } else {\n      hideBtn(); // скрываем кнопку, если нет изображений\n      iziToast.warning({\n        message: 'No more images to load.',\n        backgroundColor: '#ffa500',\n        messageSize: 16,\n        messageColor: '#FFF',\n        iconColor: '',\n        titleColor: '#fa0598e5',\n        icon: 'info-outline',\n        titleSize: 16,\n        messageLineHeight: 24,\n        position: 'topRight',\n      });\n    }\n\n    smoothScroll(); // прокрутка к новым изображениям\n  } catch (error) {\n    console.log('Ошибка при загрузке следующей страницы:', error);\n    iziToast.error({\n      message: 'Ошибка при загрузке следующей страницы',\n      backgroundColor: '#ff0000',\n      position: 'topRight',\n    });\n  } finally {\n    hideLoaderButton(); // всегда скрываем лоадер кнопки\n  }\n});\n"],"names":["arrData","totalImage","totalPages","_per_page","API_KEY","BASE_URL","fetchGallery","search","page","response","axios","error","lightbox","SimpleLightbox","renderGallery","markup","data2","refs","_page","showLoader","hideLoader","showLoaderButton","hideLoaderButton","showBtn","hideBtn","clearPage","handleFormSubmit","event","iziToast","smoothScroll","scrolHeight","hits","totalHits"],"mappings":"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"}